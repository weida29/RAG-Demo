# RAG法律问答系统项目整理文档

## 项目概述

这是一个基于检索增强生成（RAG）技术的中国民法典智能问答系统。通过将民法典文本进行预处理、向量化检索和AI生成回答，为用户提供准确的法律咨询服务。

## 项目结构

### 根目录文件
- `main.py` - Streamlit Web应用主入口，实现问答界面
- `README.md` - 项目说明文档（当前为空）
- `requirements.txt` - Python依赖包列表
- `项目整理文档.md` - 本文档

### 源代码目录 (`src/`)
- `__init__.py` - 包初始化文件
- `api.py` - OpenAI API接口封装
- `clean_laws.py` - 法律条文清洗和AI优化处理
- `getlaws.py` - 从PDF/文本中提取法律条文
- `pdf2text.py` - PDF文档文本提取功能

### 数据目录 (`data/`)
- `articles/` - 原始法律条文文件（1260个txt文件）
- `ori_pdf/` - 原始PDF文档
  - `1.pdf` - 测试PDF文件
  - `laws/` - 法律相关PDF目录
  - `民法典.pdf` - 中国民法典PDF原文件
- `output/民法典/` - 处理后的数据
  - `articles_clean/` - AI清洗后的条文文件（1259个文件）
  - `articles_raw/` - 原始提取的条文文件（1260个文件）
  - `民法典.txt` - 完整的民法典文本

## 核心功能模块

### 1. 数据预处理管道
```
PDF → 文本提取 → 条文切分 → AI清洗 → 结构化存储
```

#### 主要流程：
1. **PDF文本提取** (`pdf2text.py`)
   - 使用PyPDF2库提取PDF中文本
   - 支持AI辅助的文本清洗

2. **法律条文切分** (`getlaws.py`)
   - 正则表达式识别条文标题（如"第十二条"）
   - 中文数字转换为阿拉伯数字
   - 按条文编号保存为独立文件

3. **AI智能清洗** (`clean_laws.py`)
   - 使用DeepSeek模型优化条文格式
   - 提取标题和正文内容
   - 去除杂项标记和格式问题
   - 批量处理和多线程优化

### 2. 问答系统 (`main.py`)
基于Streamlit构建的Web界面，包含：
- 关键词提取（AI + 本地算法双重保障）
- 基于字符串匹配的本地检索
- AI生成回答（严格基于检索结果）

### 3. API接口 (`api.py`)
- OpenAI兼容接口封装
- 支持环境变量配置API密钥
- 统一的对话接口

## 技术栈

### 核心依赖
- **Streamlit** - Web界面框架
- **OpenAI** - AI模型API
- **PyPDF2** - PDF文本提取
- **python-dotenv** - 环境变量管理

### 技术特点
- **检索策略**：关键词权重匹配（AI提取关键词权重3，本地分词权重1）
- **AI模型**：默认使用deepseek-chat
- **数据格式**：每条法律条文存储为单独的txt文件
- **并发处理**：多线程批量处理AI清洗任务

## 数据处理流程

### 完整处理管道
1. **原始PDF** → 民法典.pdf
2. **文本提取** → 民法典.txt（完整文本）
3. **条文切分** → articles_raw/（1260个原始条文）
4. **AI清洗优化** → articles_clean/（1259个优化条文）
5. **问答系统** → 加载清洗后的条文进行检索

### 数据质量
- 原始条文：1260条
- 清洗后条文：1259条（可能因清洗过程中合并或过滤）
- 文件命名：`XXXX_标题.txt`格式，便于排序和检索

## 使用说明

### 环境配置
1. 安装依赖：`pip install -r requirements.txt`
2. 配置环境变量：
   - `API_KEY` - OpenAI API密钥
   - `BASE_URL` - API基础URL（可选）

### 运行应用
```bash
streamlit run main.py
```

### 数据处理
```bash
# 从PDF提取并清洗条文
python src/clean_laws.py --pdf data/ori_pdf/民法典.pdf

# 仅提取条文（不清洗）
python src/getlaws.py --input data/民法典.txt --output data/articles
```

## 项目特点

### 优势
1. **本地化部署**：支持完全本地化运行，无需外部知识库
2. **精确检索**：基于法律条文的专业检索算法
3. **AI优化**：结合AI能力提升数据质量和回答准确性
4. **模块化设计**：各功能模块独立，便于维护和扩展

### 技术亮点
1. **智能关键词提取**：AI提取专业关键词 + 本地分词双重保障
2. **法律文本清洗**：专门针对法律文本的格式化处理
3. **增量式检索**：支持配置检索条目数量，平衡精度和效率
4. **容错机制**：AI调用失败时自动降级到本地处理

## 文件统计

- **源代码文件**：6个
- **数据文件**：2520个条文文件 + 3个PDF + 1个完整文本
- **总数据量**：约2.5GB的法律文本数据

## 维护建议

1. **数据更新**：定期检查民法典是否有修订版本
2. **模型优化**：可以尝试不同的AI模型提升效果
3. **性能调优**：根据硬件条件调整并发线程数
4. **监控日志**：添加更详细的处理日志和错误追踪

---

*文档生成时间：2025年1月9日*
*项目状态：完整可运行*
